{% extends 'base.html' %}
{% load static %}

{% block content %}
    <div class="form-container">

        <form method="GET" action="{% url 'selos' %}">
            <label for="ano">Ano:</label>
            <select name="ano">
                {% for ano in anos_disponiveis %}
                    <option value="{{ ano }}" {% if ano == ano %}selected{% endif %}>{{ ano }}</option>
                {% endfor %}
            </select>
        
            <label for="mes">Mês:</label>
            <select name="mes">
                {% for mes in meses_disponiveis %}
                    <option value="{{ mes }}" {% if mes == mes %}selected{% endif %}>
                        {% if mes == 1 %}Janeiro{% elif mes == 2 %}Fevereiro{% elif mes == 3 %}Março{% elif mes == 4 %}Abril{% elif mes == 5 %}Maio{% elif mes == 6 %}Junho{% elif mes == 7 %}Julho{% elif mes == 8 %}Agosto{% elif mes == 9 %}Setembro{% elif mes == 10 %}Outubro{% elif mes == 11 %}Novembro{% elif mes == 12 %}Dezembro{% endif %}
                    </option>
                {% endfor %}
            </select>
        
            <button type="submit">Filtrar</button>
        </form>
        
        <h1>Selos</h1>

        <!-- Exibe a mensagem de sucesso -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <h2>Relatório de Vendas - {{ request.user.first_name }}</h2>
        <p>Mês atual: {{ mes_atual }}/{{ ano_atual }}</p>

        <table border="1">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Semana</th>
                    <th>Loja</th>
                    <th>Peças Vendidas</th>
                    <th>Ações</th> <!-- Nova coluna para os botões -->
                </tr>
            </thead>
            <tbody>
                {% for venda in vendas %}
                    <tr>
                        <td>{{ venda.data_venda }}</td>  <!-- Acessando o valor de data_venda -->
                        <td>{{ venda.dia_semana }}</td>  <!-- Acessando o valor de dia_semana -->
                        <td>{{ venda.loja }}</td>        <!-- Acessando o nome da loja -->
                        <td>{{ venda.quantidade_vendida }}</td>  <!-- Acessando a quantidade vendida -->
                        <td>
                            {% if venda.id %}
                                <a href="{% url 'editar_venda' venda.id %}">
                                    <img src="{% static 'images/btn-edit.png' %}" alt="Editar" width="20">
                                </a>
                        
                                <a href="{% url 'apagar_venda' venda.id %}" onclick="return confirm('Tem certeza que deseja excluir esta venda?');">
                                    <img src="{% static 'images/btn-erase.png' %}" alt="Excluir" width="20">
                                </a>
                            {% else %}
                                <span>Erro: ID não encontrado</span>
                            {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="4">Nenhuma venda registrada este mês.</td>
                    </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="3"><strong>Total Vendido</strong></td>
                    <td><strong>{{ total_vendido }}</strong></td>
                </tr>
            </tfoot>
        </table>
    </div>
{% endblock %}
